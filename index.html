<html> 
<head> 
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" /> 
	<title>SACAD Polygon Creator</title>
	<meta name="keywords" content="polygon,creator,google map,v3,draw,paint">
	<meta name="description" content="SACAD Polygon Creator">
	
	
	<link rel="stylesheet" type="text/css" href="style.css">
	
	
	<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
	<script type="text/javascript" src="jquery-1.4.2.min.js"></script>
	<script type="text/javascript" src="polygon.js"></script>
	<script src="proj4-src.js"></script>
	
	<script type="text/javascript">
	$(function(){
		  //create map
		 var adelaideCenter=new google.maps.LatLng(-34.9285, 138.6007);
		 var myOptions = {
		  	zoom: 10,
		  	center: adelaideCenter,
		  	mapTypeId: google.maps.MapTypeId.ROADMAP
		  }
		 map = new google.maps.Map(document.getElementById('main-map'), myOptions);
		 
		 var creator = new PolygonCreator(map);
		 
		 //reset
		 $('#reset').click(function(){ 
				$('#dataPanel').empty();
				
		 		creator.destroy();
		 		creator=null;
		 		
		 		creator=new PolygonCreator(map);
		 });		 
		 
		 
		 //show paths
		 $('#showData').click(function(){ 
		 		$('#dataPanel').empty();
		 		if(null==creator.showData()){
		 			$('#dataPanel').append('Create a Polygon first');
		 		}else{
		 			$('#dataPanel').append(creator.showData());
		 		}
		 });
		 
		 $('#convertData').click(function(){ 
				var lf = String.fromCharCode(10);
		 		$('#dataPanel').empty();
				if(null==creator.showData()){
		 			$('#dataPanel').append('Create a polygon first');
		 		} else {
				
						var paths = creator.pen.polygon.getPlots();
						$('#dataPanel').append("ESZ: xxx<BR />");
						$('#dataPanel').append("VALUE: THIS FIELD MUST BE PRESENT<BR />");
						$('#dataPanel').append("NUM: " + paths.getAt(0).length + "<BR />");
						paths.getAt(0).forEach(function(value, index){
							northeast = convertString( value.toString() )
							
							var northing = northeast[0];
							var easting = northeast[1];
							
							var northingarray = northing.toString().split(".");
							var eastingarray = easting.toString().split(".");
							
							var northingString = northingarray[0] + northingarray[1].substring(0,2);
							var eastingString = eastingarray[0] +  eastingarray[1].substring(0,2);
							
														 
							$('#dataPanel').append("XY: " + northingString + "    " + eastingString );
							$('#dataPanel').append("<br />");
							
							});
							$('#dataPanel').append("END");
							
						}
				}
		 );
		 
		function convertString(thestr){
		 var lat;
		 var lng;
		 thestr = thestr.replace("(", "");
		 thestr = thestr.replace(")", "");
		 var values = thestr.split(",");
		 lat = 	parseFloat(values[0]);
		 lng =  parseFloat(values[1]);
		 
		 //console.log(convertreverse(lat, lng));
		 
		 return (convertreverse(lat, lng));
		 
		 
		 
		 
		}
	
	
		function convertreverse(xin, yin) {
			var from = '+proj=lcc +lat_1=-28 +lat_2=-36 +lat_0=-32 +lon_0=135 +x_0=1000000 +y_0=2000000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs'; 
			var to = '+proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs';
			return(proj4(to, from, [yin, xin]));
			}

		 
		 
		 
		 //show color
		 $('#showColor').click(function(){ 
		 		$('#dataPanel').empty();
		 		if(null==creator.showData()){
		 			$('#dataPanel').append('Please first create a polygon');
		 		}else{
		 				$('#dataPanel').append(creator.showColor());
		 		}
		 });
	});	
	</script>
</head>
<body>
	<div id="header">
	   <p><span class="instruction">SACAD Polygon creator </span>Left click on the map to create markers, click on your first marker to finish the polygon.</p>
	</div>
	<div id="main-map">
	</div>
	<div id="side">
		<input id="reset" value="Reset" type="button" class="navi"/>
		<input id="showData"  value="Show Latitudes/Longitudes" type="button" class="navi"/>
		<input id="convertData"  value="Generate SACAD Polygon (Lambert Conf.)" type="button" class="navi"/>
		<div   id="dataPanel">
		</div>
	</div>
</body>
</html>
